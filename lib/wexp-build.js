"use strict";var _compile=require("./compile/compile"),_compile2=_interopRequireDefault(_compile),_util=require("./utils/util"),_util2=_interopRequireDefault(_util),_chokidar=require("chokidar"),_chokidar2=_interopRequireDefault(_chokidar),_path=require("path"),_path2=_interopRequireDefault(_path),_eslint=require("./utils/eslint"),_eslint2=_interopRequireDefault(_eslint),_glob=require("glob"),_glob2=_interopRequireDefault(_glob);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var srcPath=_path2.default.resolve(process.cwd(),"src");function doCompile(e){var l="src"+_util2.default.getRelativePath(e);e.match(/(.*)\.(gif|jpg|jpeg|bmp|png|ttf|eot|woff|svg|webp)/gi)?(_util2.default.log(" [拷贝静态资源]".yellow+" "+l),_compile2.default.compileFile(e)):0<=e.indexOf(".js")?(_util2.default.log(" [编译js文件]".blue+" "+l),_compile2.default.compileScript(e),(0,_eslint2.default)(e)):0<=e.indexOf(".xu")?(_util2.default.log(" [编译xu文件]".blue+" "+l),_compile2.default.compileXu(e),(0,_eslint2.default)(e)):0<=e.indexOf(".less")?(_util2.default.log(" [编译less文件]".blue+" "+l),_compile2.default.compileStyle(e)):0<=e.indexOf(".wxss")?(_util2.default.log(" [编译wxss文件]".blue+" "+l),_compile2.default.compileStyle(e)):0<=e.indexOf(".wxml")?(_util2.default.log(" [编译wxml文件]".blue+" "+l),_compile2.default.compileWxml(e)):0<=e.indexOf(".wxs")?_compile2.default.compileWxs(e):0<=e.indexOf(".json")&&_compile2.default.compileJson(e)}function doBuild(){process.env.NODE_ENV="production",_glob2.default.sync(srcPath+"/**/*.*").forEach(function(e){doCompile(e)})}exports=module.exports=function(e){process.env.NODE_ENV="development",console.log(process.cwd()),e.watch?_chokidar2.default.watch(srcPath).on("all",function(e,l){switch(e){case"unlinkDir":_util2.default.delDir(l,!0);break;case"unlink":_util2.default.delDir(l,!1);break;case"addDir":break;case"add":case"change":doCompile(l)}}):doBuild()};