"use strict";var _compile=require("./compile/compile"),_compile2=_interopRequireDefault(_compile),_util=require("./utils/util"),_util2=_interopRequireDefault(_util),_chokidar=require("chokidar"),_chokidar2=_interopRequireDefault(_chokidar),_path=require("path"),_path2=_interopRequireDefault(_path),_eslint=require("./utils/eslint"),_eslint2=_interopRequireDefault(_eslint),_glob=require("glob"),_glob2=_interopRequireDefault(_glob);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var srcPath=_path2.default.resolve(process.cwd(),"src"),readyStatus=!1;function doCompile(e){var l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",t="src"+_util2.default.getRelativePath(e),i=_util2.default.getExt(e);if(l){var a="change"===l?"变更":"新增";_util2.default.log("[".black.bgYellow+a.black.bgYellow+"]".black.bgYellow+" "+i+": "+t)}if(e.match(/(.*)\.(gif|jpg|jpeg|bmp|png|ttf|eot|woff|svg|webp)/gi))_util2.default.log("[拷贝]".yellow+" "+i+": "+t),_compile2.default.compileFile(e);else switch(_path2.default.parse(e).ext){case".js":_util2.default.log("[编译]".blue+" "+i+": "+t),_compile2.default.compileScript(e);break;case".xu":_util2.default.log("[编译]".blue+" "+i+": "+t),_compile2.default.compileXu(e);break;case".less":case".wxss":_util2.default.log("[编译]".blue+" "+i+": "+t),_compile2.default.compileStyle(e);break;case".wxml":_util2.default.log("[编译]".blue+" "+i+": "+t),_compile2.default.compileWxml(e);break;case".wxs":_compile2.default.compileWxs(e);break;case".json":_compile2.default.compileJson(e)}}function doBuild(){process.env.NODE_ENV="production",_glob2.default.sync(srcPath+"/**/*.*").forEach(function(e){doCompile(e)})}exports=module.exports=function(e){process.env.NODE_ENV="development",console.log(process.cwd()),e.watch?_chokidar2.default.watch(srcPath).on("all",function(e,l){switch(e){case"unlinkDir":_util2.default.delDir(l,!0);break;case"unlink":_util2.default.delDir(l,!1);break;case"addDir":break;case"add":doCompile(l,readyStatus?"add":"");break;case"change":doCompile(l,readyStatus?"change":"")}}).on("ready",function(){setTimeout(function(){readyStatus=!0,_util2.default.log("[提示]".grey+" 开始监听文件改动。")},0)}):doBuild()};