"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(F,e){var t=_util2.default.getRelativePath(F),r=t.replace(".xu",".js");if(0<F.indexOf(".xu")){var l=_util2.default.babelJs(e,F);l&&l.code&&_util2.default.getNpmComponent(_util2.default.getConfig(l.code)).then(function(a){var u=t.replace(".xu",".json"),e=_util2.default.getTypeUrl(F);_util2.default.getModuleName(l.code,e.type).then(function(e){if(e=e.replace(/require\(['"]([\w\d_\-\.\/]+)['"]\)/gi,function(e,t){var l="require('"+t+"')";if(0!==t.indexOf(".")&&0!==t.indexOf("/")){var a=t.split("/"),u=a.length,r=a[0],i=_path2.default.resolve(projectPath,"./node_modules/"+r),d=_path2.default.resolve(i,"package.json");if(1<u){var f=t.replace(".js","")+".js",s=_path2.default.resolve(nodePath,f),p=_path2.default.parse(F),o=_path2.default.resolve(p.dir,f);if(_fs2.default.existsSync(o))_util2.default.depCopyNpm(o),l="require('./"+f+"')";else{var _=_path2.default.resolve(distPath,"./npm/"+f),n=F.replace("src","dist"),c=_path2.default.relative(n,_).replace("../","");if(_fs2.default.existsSync(d)){var h=_fs2.default.readFileSync(d,{encoding:"utf8"}),v=new Function("return "+h)();if(v.miniprogram){var g=_path2.default.resolve(i,"./"+v.miniprogram),j=_path2.default.resolve(g,f.replace(r,"."));_fs2.default.existsSync(j)?_util2.default.depCopyNpm(j):_util2.default.depCopyNpm(s)}else _util2.default.depCopyNpm(s)}else _util2.default.depCopyNpm(s);l="require('"+c+"')"}}else if(0<t.indexOf(".js"))l="require('./"+t+"')";else{var m=_path2.default.parse(F),y=_path2.default.resolve(m.dir,"./"+t+".js");if(_fs2.default.existsSync(y))_util2.default.depCopyNpm(y);else if(_fs2.default.existsSync(d)){var P=_fs2.default.readFileSync(d,{encoding:"utf8"}),x=new Function("return "+P)().main,q=_path2.default.resolve(i,x),N=_path2.default.resolve(distPath,"./npm/"+r+"/"+x),w=F.replace("src","dist"),C=_path2.default.relative(w,N).replace("../","");_util2.default.depCopyNpm(q),l="require('"+C+"')"}else _util2.default.log("[错误]".red+" 未发现模块 ".red+r.red)}}return l}),"production"===process.env.NODE_ENV){var t=_util2.default.upjs(e).code,l=_util2.default.trim(a);_util2.default.writeFile(_path2.default.resolve(projectPath,r),t),_util2.default.log("[写入]".green+" js  : dist"+r),_util2.default.writeFile(_path2.default.resolve(projectPath,u),l),_util2.default.log("[写入]".green+" json: dist"+u)}else _util2.default.writeFile(_path2.default.resolve(projectPath,r),e),_util2.default.log("[写入]".green+" js  : dist"+r),_util2.default.writeFile(_path2.default.resolve(projectPath,u),a),_util2.default.log("[写入]".green+" json: dist"+u)})})}else{var a=_util2.default.getJsContent(F);_util2.default.writeFile(_path2.default.resolve(projectPath,t),a),_util2.default.log("[拷贝]".yellow+" js  : dist"+r)}};var _fs=require("fs"),_fs2=_interopRequireDefault(_fs),_path=require("path"),_path2=_interopRequireDefault(_path),_util=require("../utils/util"),_util2=_interopRequireDefault(_util);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var projectPath=process.cwd(),distPath=_path2.default.resolve(projectPath,"dist"),nodePath=_path2.default.resolve(projectPath,"./node_modules");